<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEI vs Merit Simulation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin-bottom: 20px; }
        #results, #drilldown { display: none; }
        table { border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <div class="section">
        <h1>DEI vs Merit Hiring Simulation</h1>
        <label>Profession: </label>
        <select id="profession" onchange="updateBreakdown()">
            <option value="software">Software Engineer</option>
            <option value="finance">Financial Analyst</option>
            <option value="teacher">Teacher</option>
            <option value="hr">Human Resources</option>
        </select>
    </div>
    <div class="section">
        <h2>Graduate Breakdown</h2>
        <button onclick="toggleView()">Toggle Chart/Table</button>
        <canvas id="breakdownChart" width="400" height="200"></canvas>
        <div id="breakdownTable"></div>
    </div>
    <div class="section">
        <h2>Settings</h2>
        <label>Hires per Company: <input type="number" id="hiresPer" min="1" max="10" value="5"></label><br>
        <label>Total Companies: <input type="number" id="companies" min="2" max="20" value="10"></label><br>
        <label>Speed: <input type="range" id="speed" min="0" max="3" value="1"></label> (0=Instant, 3=Step)
    </div>
    <div class="section">
        <button onclick="runSimulation()">Run Simulation</button>
        <button onclick="stepSimulation()" id="stepBtn" style="display:none;">Next Step</button>
    </div>
    <div class="section" id="results">
        <h2>Results</h2>
        <div id="output"></div>
        <button onclick="toggleResultsView()">Toggle Chart/Table</button>
        <canvas id="resultsChart" width="400" height="200"></canvas>
        <div id="resultsTable"></div>
        <div id="drilldown">
            <h3>Drilldown: <span id="drilldownTitle"></span></h3>
            <div id="drilldownContent"></div>
            <button onclick="hideDrilldown()">Back</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const data = {
            software: { White: { M: 30, F: 20 }, Asian: { M: 15, F: 10 }, Hispanic: { M: 6, F: 4 }, Black: { M: 6, F: 4 }, Other: { M: 3, F: 2 } },
            finance: { White: { M: 32, F: 28 }, Asian: { M: 8, F: 7 }, Hispanic: { M: 5, F: 5 }, Black: { M: 5, F: 5 }, Other: { M: 3, F: 2 } },
            teacher: { White: { M: 20, F: 50 }, Black: { M: 3, F: 7 }, Hispanic: { M: 3, F: 7 }, Asian: { M: 2, F: 3 }, Other: { M: 2, F: 3 } },
            hr: { White: { M: 15, F: 50 }, Black: { M: 4, F: 11 }, Hispanic: { M: 3, F: 7 }, Asian: { M: 2, F: 3 }, Other: { M: 2, F: 3 } }
        };

        let breakdownChart, resultsChart;
        let isChartView = true, isResultsChartView = true;
        let candidates = [], hires = [], stepIndex = 0;

        function updateBreakdown() {
            const profession = document.getElementById('profession').value;
            const breakdown = data[profession];
            const labels = Object.keys(breakdown);
            const values = labels.map(ethnicity => breakdown[ethnicity].M + breakdown[ethnicity].F);

            if (breakdownChart) breakdownChart.destroy();
            if (isChartView) {
                document.getElementById('breakdownChart').style.display = 'block';
                document.getElementById('breakdownTable').style.display = 'none';
                breakdownChart = new Chart(document.getElementById('breakdownChart'), {
                    type: 'pie',
                    data: { labels, datasets: [{ data: values, backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'] }] },
                    options: {
                        onClick: (e, elements) => {
                            if (elements.length) {
                                const index = elements[0].index;
                                showDrilldown(labels[index], breakdown[labels[index]]);
                            }
                        }
                    }
                });
            } else {
                document.getElementById('breakdownChart').style.display = 'none';
                document.getElementById('breakdownTable').style.display = 'block';
                document.getElementById('breakdownTable').innerHTML = `
                    <table>
                        <tr><th>Ethnicity</th><th>Male</th><th>Female</th><th>Total</th></tr>
                        ${labels.map(e => `<tr><td>${e}</td><td>${breakdown[e].M}%</td><td>${breakdown[e].F}%</td><td>${breakdown[e].M + breakdown[e].F}%</td></tr>`).join('')}
                    </table>`;
            }
        }

        function toggleView() {
            isChartView = !isChartView;
            updateBreakdown();
        }

        function toggleResultsView() {
            isResultsChartView = !isResultsChartView;
            displayResults();
        }

        function showDrilldown(ethnicity, details) {
            document.getElementById('drilldown').style.display = 'block';
            document.getElementById('drilldownTitle').innerText = ethnicity;
            document.getElementById('drilldownContent').innerHTML = `Male: ${details.M}%, Female: ${details.F}%`;
        }

        function hideDrilldown() {
            document.getElementById('drilldown').style.display = 'none';
        }

        function generateCandidates() {
            candidates = [];
            const profession = document.getElementById('profession').value;
            const breakdown = data[profession];
            for (let ethnicity in breakdown) {
                for (let sex in breakdown[ethnicity]) {
                    const count = Math.round(breakdown[ethnicity][sex]);
                    for (let i = 0; i < count; i++) {
                        candidates.push({
                            id: `${ethnicity}-${sex}-${i}`,
                            rank: Math.floor(Math.random() * 100) + 1,
                            ethnicity,
                            sex,
                            minority: ethnicity !== 'White' || sex === 'F'
                        });
                    }
                }
            }
            candidates.sort((a, b) => a.rank - b.rank); // Best rank first
        }

        function runSimulation() {
            const hiresPer = parseInt(document.getElementById('hiresPer').value);
            const totalCompanies = parseInt(document.getElementById('companies').value);
            const speed = parseInt(document.getElementById('speed').value);
            generateCandidates();
            hires = [];
            stepIndex = 0;

            const meritCompanies = Math.floor(totalCompanies / 2);
            const deiCompanies = totalCompanies - meritCompanies;

            let pool = [...candidates];
            for (let i = 0; i < meritCompanies; i++) {
                hires.push({ type: 'Merit', id: `M${i+1}`, hires: pool.splice(0, hiresPer), avgRank: 0 });
            }
            for (let i = 0; i < deiCompanies; i++) {
                let deiHires = [];
                let minorities = pool.filter(c => c.minority);
                let nonMinorities = pool.filter(c => !c.minority);
                for (let j = 0; j < hiresPer; j++) {
                    if (j < hiresPer / 2 && minorities.length) {
                        deiHires.push(minorities.shift());
                    } else if (nonMinorities.length) {
                        deiHires.push(nonMinorities.shift());
                    } else if (minorities.length) {
                        deiHires.push(minorities.shift());
                    }
                }
                hires.push({ type: 'DEI', id: `D${i+1}`, hires: deiHires, avgRank: 0 });
            }

            hires.forEach(co => {
                co.avgRank = co.hires.reduce((sum, h) => sum + h.rank, 0) / co.hires.length;
            });

            if (speed === 0) {
                displayResults();
            } else if (speed === 3) {
                document.getElementById('stepBtn').style.display = 'inline';
                stepSimulation();
            } else {
                let delay = [0, 500, 1000, 2000][speed];
                let i = 0;
                const interval = setInterval(() => {
                    if (i >= hires.length) {
                        clearInterval(interval);
                        displayResults();
                    } else {
                        displayStep(i);
                        i++;
                    }
                }, delay);
            }
        }

        function stepSimulation() {
            if (stepIndex < hires.length) {
                displayStep(stepIndex);
                stepIndex++;
            } else {
                document.getElementById('stepBtn').style.display = 'none';
                displayResults();
            }
        }

        function displayStep(index) {
            const output = document.getElementById('output');
            output.innerHTML += `${hires[index].type} ${hires[index].id}: Avg Rank ${hires[index].avgRank.toFixed(2)}<br>`;
            document.getElementById('results').style.display = 'block';
        }

        function displayResults() {
            const output = document.getElementById('output');
            output.innerHTML = hires.map(co => `${co.type} ${co.id}: Avg Rank ${co.avgRank.toFixed(2)}`).join('<br>');

            if (resultsChart) resultsChart.destroy();
            if (isResultsChartView) {
                document.getElementById('resultsChart').style.display = 'block';
                document.getElementById('resultsTable').style.display = 'none';
                resultsChart = new Chart(document.getElementById('resultsChart'), {
                    type: 'bar',
                    data: {
                        labels: hires.map(co => `${co.type} ${co.id}`),
                        datasets: [{ label: 'Avg Rank', data: hires.map(co => co.avgRank), backgroundColor: hires.map(co => co.type === 'Merit' ? '#36A2EB' : '#FF6384') }]
                    },
                    options: {
                        scales: { y: { beginAtZero: true, max: 100 } },
                        onClick: (e, elements) => {
                            if (elements.length) {
                                const index = elements[0].index;
                                showDrilldown(`${hires[index].type} ${hires[index].id}`, hires[index]);
                            }
                        }
                    }
                });
            } else {
                document.getElementById('resultsChart').style.display = 'none';
                document.getElementById('resultsTable').style.display = 'block';
                document.getElementById('resultsTable').innerHTML = `
                    <table>
                        <tr><th>Company</th><th>Avg Rank</th></tr>
                        ${hires.map(co => `<tr><td>${co.type} ${co.id}</td><td>${co.avgRank.toFixed(2)}</td></tr>`).join('')}
                    </table>`;
            }
            document.getElementById('results').style.display = 'block';
            document.getElementById('stepBtn').style.display = 'none';
        }

        updateBreakdown(); // Initial load
    </script>
</body>
</html>